{"ast":null,"code":"export const calculateLoan = input => {\n  // 计算最大贷款金额\n  const maxLoanAmount = calculateMaxLoanAmount(input);\n\n  // 计算最长贷款期限\n  const maxLoanTerm = calculateMaxLoanTerm(input);\n\n  // 计算月供\n  const monthlyPayment = calculateMonthlyPayment(maxLoanAmount, maxLoanTerm);\n\n  // 计算相关费用\n  const fees = calculateFees(input);\n  return {\n    maxLoanAmount,\n    maxLoanTerm,\n    monthlyPayment,\n    fees\n  };\n};\nconst calculateMaxLoanAmount = input => {\n  const {\n    userType,\n    propertyValue,\n    monthlyIncome,\n    existingDebt,\n    maxLoanTerm\n  } = input;\n\n  // 本地居民最高可贷80%，外籍人士最高可贷75%\n  const maxLoanToValue = userType === 'local' ? 0.8 : 0.75;\n\n  // 月供不超过月收入的50%\n  const maxMonthlyPayment = monthlyIncome * 0.5 - existingDebt;\n\n  // 根据月供计算最大贷款金额，使用计算得出的贷款期限\n  const maxLoanByIncome = maxMonthlyPayment * 12 * calculateMaxLoanTerm(input);\n\n  // 取较小值\n  return Math.min(propertyValue * maxLoanToValue, maxLoanByIncome);\n};\nconst calculateMaxLoanTerm = input => {\n  const {\n    userType,\n    propertyType,\n    age\n  } = input;\n\n  // 本地居民最长到70岁，外籍人士最长到65岁\n  const maxAge = userType === 'local' ? 70 : 65;\n\n  // 计算基于年龄的最大贷款期限\n  const maxTermByAge = Math.max(0, maxAge - age);\n\n  // 原有逻辑：本地居民最长25年，外籍人士最长20年\n  const baseTerm = userType === 'local' ? 25 : 20;\n\n  // 根据房产类型调整期限\n  let adjustedTerm;\n  switch (propertyType) {\n    case 'first':\n      adjustedTerm = baseTerm;\n      break;\n    case 'second':\n      adjustedTerm = baseTerm - 5;\n      break;\n    case 'offPlan':\n      adjustedTerm = baseTerm - 2;\n      break;\n    default:\n      adjustedTerm = baseTerm;\n  }\n\n  // 取两者中的较小值\n  return Math.min(adjustedTerm, maxTermByAge);\n};\nconst calculateMonthlyPayment = (loanAmount, loanTerm) => {\n  // 贷款期限为0时，月供设为0\n  if (loanTerm <= 0) return 0;\n\n  // 假设年利率为4%\n  const annualRate = 0.04;\n  const monthlyRate = annualRate / 12;\n  const numberOfPayments = loanTerm * 12;\n  return loanAmount * monthlyRate * Math.pow(1 + monthlyRate, numberOfPayments) / (Math.pow(1 + monthlyRate, numberOfPayments) - 1);\n};\nconst calculateFees = input => {\n  const {\n    propertyValue,\n    loanType\n  } = input;\n\n  // 评估费：房产价值的0.5%\n  const evaluation = propertyValue * 0.005;\n\n  // 登记费：房产价值的0.5%\n  const registration = propertyValue * 0.005;\n\n  // 转让费：根据贷款类型不同\n  let transfer = 0;\n  switch (loanType) {\n    case 'new':\n      transfer = propertyValue * 0.02; // 2%\n      break;\n    case 'refinance':\n      transfer = propertyValue * 0.01; // 1%\n      break;\n    case 'cashout':\n      transfer = propertyValue * 0.015; // 1.5%\n      break;\n    case 'combined':\n      transfer = propertyValue * 0.025; // 2.5%\n      break;\n  }\n  return {\n    evaluation,\n    registration,\n    transfer\n  };\n};","map":{"version":3,"names":["calculateLoan","input","maxLoanAmount","calculateMaxLoanAmount","maxLoanTerm","calculateMaxLoanTerm","monthlyPayment","calculateMonthlyPayment","fees","calculateFees","userType","propertyValue","monthlyIncome","existingDebt","maxLoanToValue","maxMonthlyPayment","maxLoanByIncome","Math","min","propertyType","age","maxAge","maxTermByAge","max","baseTerm","adjustedTerm","loanAmount","loanTerm","annualRate","monthlyRate","numberOfPayments","pow","loanType","evaluation","registration","transfer"],"sources":["E:/Loan/LoanCalculatorV2/src/utils/loanCalculator.ts"],"sourcesContent":["export interface LoanInput {\r\n  userType: 'local' | 'expat';\r\n  propertyValue: number;\r\n  propertyType: 'first' | 'second' | 'offPlan';\r\n  monthlyIncome: number;\r\n  existingDebt: number;\r\n  loanType: 'new' | 'refinance' | 'cashout' | 'combined';\r\n  age: number;\r\n}\r\n\r\nexport interface LoanResult {\r\n  maxLoanAmount: number;\r\n  maxLoanTerm: number;\r\n  monthlyPayment: number;\r\n  fees: {\r\n    evaluation: number;\r\n    registration: number;\r\n    transfer: number;\r\n  };\r\n}\r\n\r\nexport const calculateLoan = (input: LoanInput): LoanResult => {\r\n  // 计算最大贷款金额\r\n  const maxLoanAmount = calculateMaxLoanAmount(input);\r\n  \r\n  // 计算最长贷款期限\r\n  const maxLoanTerm = calculateMaxLoanTerm(input);\r\n  \r\n  // 计算月供\r\n  const monthlyPayment = calculateMonthlyPayment(maxLoanAmount, maxLoanTerm);\r\n  \r\n  // 计算相关费用\r\n  const fees = calculateFees(input);\r\n\r\n  return {\r\n    maxLoanAmount,\r\n    maxLoanTerm,\r\n    monthlyPayment,\r\n    fees,\r\n  };\r\n};\r\n\r\nconst calculateMaxLoanAmount = (input: LoanInput): number => {\r\n  const { userType, propertyValue, monthlyIncome, existingDebt, maxLoanTerm } = input;\r\n  \r\n  // 本地居民最高可贷80%，外籍人士最高可贷75%\r\n  const maxLoanToValue = userType === 'local' ? 0.8 : 0.75;\r\n  \r\n  // 月供不超过月收入的50%\r\n  const maxMonthlyPayment = monthlyIncome * 0.5 - existingDebt;\r\n  \r\n  // 根据月供计算最大贷款金额，使用计算得出的贷款期限\r\n  const maxLoanByIncome = maxMonthlyPayment * 12 * calculateMaxLoanTerm(input);\r\n  \r\n  // 取较小值\r\n  return Math.min(propertyValue * maxLoanToValue, maxLoanByIncome);\r\n};\r\n\r\nconst calculateMaxLoanTerm = (input: LoanInput): number => {\r\n  const { userType, propertyType, age } = input;\r\n  \r\n  // 本地居民最长到70岁，外籍人士最长到65岁\r\n  const maxAge = userType === 'local' ? 70 : 65;\r\n  \r\n  // 计算基于年龄的最大贷款期限\r\n  const maxTermByAge = Math.max(0, maxAge - age);\r\n  \r\n  // 原有逻辑：本地居民最长25年，外籍人士最长20年\r\n  const baseTerm = userType === 'local' ? 25 : 20;\r\n  \r\n  // 根据房产类型调整期限\r\n  let adjustedTerm;\r\n  switch (propertyType) {\r\n    case 'first':\r\n      adjustedTerm = baseTerm;\r\n      break;\r\n    case 'second':\r\n      adjustedTerm = baseTerm - 5;\r\n      break;\r\n    case 'offPlan':\r\n      adjustedTerm = baseTerm - 2;\r\n      break;\r\n    default:\r\n      adjustedTerm = baseTerm;\r\n  }\r\n  \r\n  // 取两者中的较小值\r\n  return Math.min(adjustedTerm, maxTermByAge);\r\n};\r\n\r\nconst calculateMonthlyPayment = (loanAmount: number, loanTerm: number): number => {\r\n  // 贷款期限为0时，月供设为0\r\n  if (loanTerm <= 0) return 0;\r\n  \r\n  // 假设年利率为4%\r\n  const annualRate = 0.04;\r\n  const monthlyRate = annualRate / 12;\r\n  const numberOfPayments = loanTerm * 12;\r\n  \r\n  return (\r\n    (loanAmount * monthlyRate * Math.pow(1 + monthlyRate, numberOfPayments)) /\r\n    (Math.pow(1 + monthlyRate, numberOfPayments) - 1)\r\n  );\r\n};\r\n\r\nconst calculateFees = (input: LoanInput) => {\r\n  const { propertyValue, loanType } = input;\r\n  \r\n  // 评估费：房产价值的0.5%\r\n  const evaluation = propertyValue * 0.005;\r\n  \r\n  // 登记费：房产价值的0.5%\r\n  const registration = propertyValue * 0.005;\r\n  \r\n  // 转让费：根据贷款类型不同\r\n  let transfer = 0;\r\n  switch (loanType) {\r\n    case 'new':\r\n      transfer = propertyValue * 0.02; // 2%\r\n      break;\r\n    case 'refinance':\r\n      transfer = propertyValue * 0.01; // 1%\r\n      break;\r\n    case 'cashout':\r\n      transfer = propertyValue * 0.015; // 1.5%\r\n      break;\r\n    case 'combined':\r\n      transfer = propertyValue * 0.025; // 2.5%\r\n      break;\r\n  }\r\n  \r\n  return {\r\n    evaluation,\r\n    registration,\r\n    transfer,\r\n  };\r\n}; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}